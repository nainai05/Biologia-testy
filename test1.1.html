<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Úvod do mikroskopickej techniky</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #333;
}
.question {
  background: white;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.answers label {
  display: block;
  margin: 5px 0;
  cursor: pointer;
}
.correct {
  background-color: #c6f6c6 !important;
}
.incorrect {
  background-color: #f6c6c6 !important;
}
.buttons {
  text-align: center;
  margin-top: 20px;
}
button {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 15px;
  margin: 5px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}
button:hover {
  background-color: #0056b3;
}
.result {
  font-weight: bold;
  text-align: center;
  margin-top: 20px;
  font-size: 18px;
}
.hidden {
  display: none;
}
</style>
</head>
<body>

<h1>1. Úvod do mikroskopickej techniky</h1>

<div class="buttons">
  <button onclick="showAllCorrect()">Zobraziť všetky správne odpovede</button>
  <button onclick="shuffleQuestions()">Zamiešať otázky</button>
</div>

<div id="quiz"></div>

<div class="buttons">
  <button onclick="evaluate()">Vyhodnotiť všetko</button>
  <button onclick="showOnlyWrong()">Zobraziť len chybné otázky</button>
  <button onclick="restartWrong()">Opakovať len chybné</button>
  <button onclick="resetQuiz()">Obnoviť test</button>
</div>

<div class="result" id="result"></div>

<script>
const key = `1:NNSN
2:NSNN
3:SNNN
4:NNNS
5:NNSS
6:NSNS
7:SSNN
8:NSNS
9:SSNS
10:NSNN
11:NNSS
12:SSSN
13:SNNN
14:NNSN
15:SNNS
16:NNSN
17:SNNS
18:SSSS
19:SSNN
20:SSSN
21:SSNS
22:SSNS
23:NNSN
24:SSNN
25:NSSS
26:SSSS
27:SSNS
28:SSNN
29:NSNS
30:SSSN
31:NNSN
32:SSSN
33:SSNN
34:SSSN
35:SNNS
36:NNNS
37:NNSN
38:NSNN
39:NSNN
40:NNSN
41:NSNN
42:NNSN
43:SNNN
44:NSNN
45:SNNN
46:NSNN
47:NSNN
48:NSNN
49:NNNS
50:SNNN
51:NSNN
52:NSNN
53:SNNN
54:SNNN
55:NNSN`;

const correctMap = {};
key.split('\n').forEach(line=>{
  const [num, val] = line.split(':');
  correctMap[num.trim()] = val.trim().split('').map((c,i)=> c==='S' ? i : null).filter(i=>i!==null);
});

const questions = [
{q:"Aké žiarenie sa využíva pri fluorescenčnej mikroskopii?", a:["infračervené žiarenie","žiarenie fialovej farby s vlnovou dĺžkou vo viditeľnom spektre","ultrafialové žiarenie","prúd elektrónov"]},
{q:"Aké farbivo sa najčastejšie využíva pri vizualizácii chromozómov?", a:["modrý atrament","Giemsovo","Lugolov roztok","hematoxylín a eozín"]},
{q:"Aké zväčšenie získame, ak použijeme objektív s 40x zväčšením a okulár s 10x zväčšením?", a:["400x","10x","40x","4x"]},
{q:"Elektrónové mikroskopy ako zdroj žiarenia používajú:", a:["biele svetlo","biele svetlo alebo ultrafialové žiarenie","elektrónkové žiarenie","prúd elektrónov"]},
{q:"Elektrónové mikroskopy:", a:["ako zdroj žiarenia využívajú prúd fotónov","nevyžadujú špeciálnu úpravu preparátov","vyžadujú špeciálnu prípravu preparátov","ako zdroj žiarenia využívajú prúd elektrónov"]},
{q:"Elektrónový mikroskop:", a:["je typ svetelného mikroskopu, vieme ním pozorovať bunky in vitro aj in vivo","umožňuje sledovať topológiu buniek a tkanív alebo vnútorné štruktúry","vieme pozorovať rovnaké preparáty pri SEM aj TEM","rozlišovacia schopnosť je väčšia ako pri konfokálnom mikroskope, preparáty sa pripravujú špecifickým spôsobom"]},
{q:"Farbenie poznáme:", a:["orientačné","špecifické","náhodné","všeobecné"]},
{q:"Fázový kontrast:", a:["slúži ako zdroj žiarenia pri málo kontrastných preparátoch","sa využíva na zvýraznenie niektorých štruktúr bunky","sa v mikroskopii vôbec nepoužíva","umožňuje pozorovanie priehľadných objektov s málo výrazným kontrastným rozhraním"]},
{q:"Invertovaný mikroskop:", a:["používa sa napr. pri sledovaní bunkových kultúr","umožňuje pozorovanie preparátov v prechádzajúcom svetle","je typ elektrónového mikroskopu","používa metódu osvetlenia zhora"]},
{q:"K mechanickej časti svetelného mikroskopu patrí:", a:["irisová clona","revolverový menič objektívov","kondenzor","objektív"]},
{q:"K osvetľovacej časti mikroskopu patrí:", a:["tubus","objektívy","zdroj svetla","kondenzor"]},
{q:"Konfokálny mikroskop:", a:["je forma svetelného fluorescenčného mikroskopu so zvýšenou rozlišovacou schopnosťou","ako zdroj svetla využíva lasery s rôznymi excitačnými vlnovými dĺžkami","pri hrubších rezoch umožňuje selektívne zaostriť a zaznamenať konkrétnu optickú rovinu","je to druh elektrónového mikroskopu"]},
{q:"Ktorá z nasledujúcich možností je najvhodnejšia na získanie povrchového zobrazenia objektu?", a:["SEM – skenovací elektrónový mikroskop","TEM – transmisný elektrónový mikroskop","invertovaný mikroskop","svetelný mikroskop"]},
{q:"Ktorá z nasledujúcich možností sa používa na vizualizáciu živých buniek?", a:["SEM – skenovací elektrónový mikroskop","TEM – transmisný elektrónový mikroskop","mikroskop s fázovým kontrastom","všetky tieto"]},
{q:"Ktoré časti mikroskopu majú zväčšujúcu schopnosť:", a:["objektív","irisová clona","kondenzor","okulár"]},
{q:"Ktorý mikroskop má obrátené poradie svetelnej a optickej časti?", a:["elektrónový","skenovací","invertovaný","rastrovací"]},
{q:"Medzi optické časti mikroskopu patrí:", a:["okulár","revolverový menič","zdroj svetla","objektív"]},
{q:"Mechanická časť mikroskopu obsahuje:", a:["tubus","revolverový menič","mikroskrutku","makroskrutku"]},
{q:"Mechanická časť mikroskopu obsahuje:", a:["makroskrutku","posúvateľný stolček","okuláre","objektívy"]},
{q:"Na orientáciu v zornom poli sa používa:", a:["rozdelenie na sústredné kruhy","rozdelenie na kvadranty","orientácia podľa ciferníka hodín","irisová clona"]},
{q:"Natívne preparáty:", a:["sa používajú pri sledovaní fyziologických prejavov buniek","používajú sa aj pri sledovaní typického tvaru buniek","umožňuje detailne pozorovať vnútrobunkové štruktúry","umožňujú sledovať pohyb buniek"]},
{q:"Obraz v mikroskope je:", a:["obrátený","zväčšený","zmenšený","skutočný"]},
{q:"Optické časti elektrónového mikroskopu:", a:["sú zo skla","tvoria šošovky z brúseného skla","tvoria elektromagnetické šošovky","sú impregnované elektrondenznými prostriedkami"]},
{q:"Optické časti svetelného mikroskopu:", a:["sú zo skla","tvoria šošovky z brúseného skla","tvoria elektromagnetické šošovky","sú impregnované elektrondenznými prostriedkami"]},
{q:"Osvetľovacia časť svetelného mikroskopu obsahuje:", a:["okulár a objektív","zdroj svetla","sústavu filtrov a clôn","kondenzor"]},
{q:"Podľa spôsobu prípravy poznáme preparáty:", a:["odtlačkové","nátery","zakryté krycím sklíčkom","trvalé"]},
{q:"Podľa typu konštrukcie rozlišujeme svetelné mikroskopy:", a:["jednoduché lupy a stereolupy","mikroskopy s jedným alebo viacerými objektívmi","elektrónové mikroskopy","invertované mikroskopy"]},
{q:"Podľa typu používaného žiarenia rozlišujeme mikroskopy:", a:["svetelné","elektrónové","elektrónkové","výbojkové"]},
{q:"Pracovná vzdialenosť:", a:["je vzdialenosť oka od mikroskopu","je vzdialenosť preparátu od frontálnej šošovky objektívu","je vzdialenosť objektívu od okulára","sa skracuje so stúpajúcim zväčšením objektívu"]},
{q:"Pre zvýraznenie štruktúr v natívnych preparátoch je možné použiť:", a:["mikroskopovanie v tmavom poli","fázový kontrast","vitálne farbenie","elektrónovú mikroskopiu"]},
{q:"Pre zvýraznenie štruktúr v natívnych preparátoch je možné použiť:", a:["mikroskopovanie v svetlom poli","fázové kontrastné farbenie","vitálne farbenie alebo fázový kontrast","elektrónovú mikroskopiu"]},
{q:"Pri pozorovaní v tmavom poli:", a:["sa používa zvláštny typ kondenzora","kondenzor mikroskopu prepúšťa len bočné svetlo","pozorujeme len lúče odrazené od objektu","fázový kontrast umožňuje pozorovanie fluoreskujúcich objektov"]},
{q:"Svetelné mikroskopy ako zdroj žiarenia používajú:", a:["biele svetlo","ultrafialové žiarenie","elektrónkové žiarenie","prúd elektrónov"]},
{q:"Svetelný mikroskop obsahuje:", a:["optickú časť","osvetľovaciu časť","mechanickú časť","biologickú časť"]},
{q:"Svetelnými mikroskopmi sa bežne pozorujú objekty:", a:["menšie ako 70 μm","väčšie ako 70 μm","menšie ako 70 nm","ktoré sa nedajú pozorovať voľným okom"]},
{q:"Transmisný elektrónový mikroskop:", a:["má šošovku z brúseného skla, využíva prúd elektrónov a skenuje povrch objektu","má šošovku z brúseného skla, využíva prúd elektrónov a môžeme ním pozorovať aj vnútro bunky","preparát je potrebné pripraviť s elektrón-denznou látkou, ktorá emituje nadmernú energiu z pohlteného UV","obsahuje elektromagnetickú šošovku a pozorujeme ním aj vnútorné štruktúry bunky"]},
{q:"Výsledné zväčšenie pri mikroskopovaní sa vypočíta ako:", a:["súčet zväčšenia objektívu a pracovnej vzdialenosti","súčin zväčšenia šošovky a zväčšenia objektívu","súčin zväčšenia objektívu a zväčšenia okulára","súčin pracovnej vzdialenosti objektívu a hrúbky sklíčka"]},
{q:"Aký je hlavný cieľ fixácie mikroskopických preparátov?", a:["zvýšenie kontrastu preparátu pri pozorovaní","zachovanie štruktúry buniek a tkanív pred poškodením alebo rozkladom","zabezpečenie lepšieho prenosu svetla cez preparát","zníženie hrúbky preparátu na optimálnu úroveň"]},
{q:"Čo vyjadruje pojem rozlišovacia schopnosť mikroskopu?", a:["maximálne dosiahnuteľné zväčšenie obrazu","minimálnu vzdialenosť medzi dvomi bodmi, ktoré ešte vidíme oddelene","schopnosť mikroskopu zachytiť čo najviac svetla","schopnosť zvýšiť kontrast bez farbenia preparátu"]},
{q:"Čo platí o numerickej apertúre objektívu?", a:["vyššia numerická apertura znamená menší prienik svetla do objektívu","numerická apertura nezávisí od použitého média medzi preparátom a objektívom","vyššia numerická apertura znamená lepší kontrast a rozlišovaciu schopnosť","numerická apertura vyjadruje len teoretické maximálne zväčšenie objektívu"]},
{q:"Čo spôsobuje sférickú aberáciu?", a:["nepravidelný lom svetla na rozhraní rôznych médií","rôzny lom svetla cez stred a okraj šošovky","vznik farebných lemov na okrajoch objektov","nesprávne uloženie preparátu na podložnom skle"]},
{q:"Ako sa prejavuje chromatická aberácia?", a:["rozmazaný obraz len v jednom smere","znížený kontrast preparátu","farebné lemy na okrajoch pozorovaných objektov","neostrý obraz pri vysokom zväčšení aj po použití imerzného oleja"]},
{q:"Aký obraz vzniká pri astigmatizme šošovky?", a:["ostrý v jednom smere a rozmazaný v druhom","s farebnými lemami na okrajoch","rozmazaný po celej ploche rovnomerne","vysoko kontrastný, ale s nízkym zväčšením"]},
{q:"Aký je hlavný princíp konfokálnej mikroskopie v porovnaní s klasickou fluorescenčnou mikroskopiou?", a:["používa polarizované svetlo na zvýraznenie štruktúr","využíva pinholový otvor na elimináciu rozptýleného svetla a získanie optických rezov","dosahuje rozlišovaciu schopnosť až 0,2 nm vďaka elektrónovému lúču","nepotrebuje fluorescenčné farbivá na zobrazenie preparátu"]},
{q:"Prečo samotné zväčšenie bez dobrej rozlišovacej schopnosti nie je postačujúce?", a:["pretože obraz zostáva veľký, ale bez detailov","pretože zväčšenie vždy znižuje kontrast","pretože vysoké zväčšenie je možné len pri elektrónovej mikroskopii","pretože zväčšenie sa nedá kombinovať s farbením preparátov"]},
{q:"Čo je hlavnou úlohou kalibrácie mikroskopu pomocou okulárového mikrometra?", a:["zvýšenie kontrastu preparátu","presné určenie rozmerov mikroštruktúr","predĺženie životnosti mikroskopu","rozlíšenie medzi natívnym a fixovaným preparátom"]},
{q:"Akou látkou sa najčastejšie fixujú preparáty, aby sa zachovala štruktúra buniek a tkanív?", a:["glycerol","formalín","agar","metylénová modrá"]},
{q:"Aká je funkcia imerzného média pri mikroskopovaní?", a:["zvyšuje životnosť optických častí","zlepšuje rozlišovaciu schopnosť a kontrast pri vysokých zväčšeniach","umožňuje pozorovať živé bunky","znižuje potrebu kalibrácie mikroskopu"]},
{q:"Aké riziko predstavuje sférická aberácia pri mikroskopovaní?", a:["vznik farebných lemov na okrajoch obrazu","rozpad štruktúry preparátu","ostrý obraz len v jednom smere","rozmazaný obraz, pretože lúče sa nelámu rovnomerne"]},
{q:"Čo charakterizuje numerickú apertúru (NA) objektívu?", a:["schopnosť zachytiť svetlo v závislosti od uhla lúčov a indexu lomu prostredia","maximálny počet pozorovateľných buniek","rýchlosť preostrovania pri práci s objektívom","veľkosť preparátu vhodného na pozorovanie"]},
{q:"Aký problém spôsobuje chromatická aberácia?", a:["obraz je rozmazaný","obraz má farebné lemy na okrajoch","obraz je ostrý len v jednom smere","obraz sa javí trojrozmerný"]},
{q:"Ako sa majú čistiť objektívy a okuláre mikroskopu?", a:["bežnou papierovou vreckovkou","špeciálnymi utierkami alebo roztokmi určenými na optiku","alkoholom technickej čistoty","destilovanou vodou"]},
{q:"Čo je základnou funkciou objektívu mikroskopu?", a:["zväčšiť obraz objektu","usmerniť lúče svetla na preparát","zabezpečiť ochranu okulára pred poškodením","upravovať intenzitu svetla"]},
{q:"Aká je funkcia stolíka mikroskopu?", a:["zabezpečuje správne uloženie preparátu","zvyšuje kontrast pozorovania","obsahuje mechanizmus na výmenu objektívov","slúži na reguláciu napätia"]},
{q:"Ktorá časť mikroskopu slúži na výmenu objektívov?", a:["tubus","okulár","revolverový nosič","kondenzor"]},

];

/* ------------------ State ------------------ */
let state = {
  questions: [], // will hold questions with original index and randomized answers
  filter: 'all', // 'all', 'wrong', 'favorites'
  favorites: new Set(),
  lastWrongSet: [], // store wrong questions for retry
};

/* Initialize questions with originalIndex and random answer order */
function initQuestions(){
  state.questions = questions.map((q,i)=>{
    const originalIndex = i; // 0-based
    const answers = q.a.map((txt, idx)=>({txt, idx}));
    return { originalIndex, qtext: q.q, answers };
  });
  renderQuestions();
}

/* Utility shuffle */
function shuffleArr(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* Render current state.questions according to filter */
function renderQuestions(){
  const container = document.getElementById('quiz');
  container.innerHTML = '';
  let toRender = state.questions.slice();

  // apply filter
  if(state.filter === 'favorites'){
    toRender = toRender.filter(item => state.favorites.has(item.originalIndex));
  } else if(state.filter === 'wrong'){
    toRender = toRender.filter(item => state.lastWrongSet.includes(item.originalIndex));
  }

  if(toRender.length === 0){
    const info = document.createElement('div');
    info.style.textAlign='center';
    info.style.color='#555';
    info.style.margin='18px';
    info.textContent = 'Žiadne otázky na zobrazenie.';
    container.appendChild(info);
    document.getElementById('resultText').textContent = '';
    return;
  }

  toRender.forEach((item, displayIdx)=>{
    // build card
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.orig = item.originalIndex;

    // header
    const header = document.createElement('div');
    header.className = 'q-header';

    const num = document.createElement('div');
    num.className = 'q-number';
    num.textContent = (displayIdx+1)+'.';

    const text = document.createElement('div');
    text.className = 'q-text';
    text.textContent = item.qtext;

    const actions = document.createElement('div');
    actions.className = 'q-actions';

    // star favorite
    const star = document.createElement('div');
    star.className = 'star';
    star.title = 'Označiť ako obľúbené';
    star.innerHTML = state.favorites.has(item.originalIndex) ? '★' : '☆';
    if(state.favorites.has(item.originalIndex)) star.classList.add('active');
    star.addEventListener('click', ()=>{
      if(state.favorites.has(item.originalIndex)){
        state.favorites.delete(item.originalIndex);
        star.classList.remove('active');
        star.innerHTML = '☆';
      } else {
        state.favorites.add(item.originalIndex);
        star.classList.add('active');
        star.innerHTML = '★';
      }
    });

    // show correct button
    const btnShow = document.createElement('button');
    btnShow.className = 'btn-small btn-show';
    btnShow.textContent = 'Zobraziť správne';
    btnShow.addEventListener('click', ()=> showCorrectForCard(card, item.originalIndex));

    actions.appendChild(star);
    actions.appendChild(btnShow);

    header.appendChild(num);
    header.appendChild(text);
    header.appendChild(actions);

    card.appendChild(header);

    // randomize answer order for display (store mapping)
    const randomized = item.answers.slice();
    // If answers not yet shuffled for this render, shuffle them each render
    const shuffledAnswers = shuffleArr(randomized);
    card._shuffled = shuffledAnswers.map(a=>a.idx); // store original idx order

    // answers block
    const answersDiv = document.createElement('div');
    answersDiv.className = 'answers';

    shuffledAnswers.forEach((ansObj, ansPos)=>{
      const label = document.createElement('label');
      label.className = 'ans';
      label.dataset.origAnswerIdx = ansObj.idx; // 0..3 original index
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.name = `q_${item.originalIndex}`;
      checkbox.value = ansObj.idx;
      label.appendChild(checkbox);
      const span = document.createElement('span');
      span.textContent = ansObj.txt;
      label.appendChild(span);
      answersDiv.appendChild(label);
    });

    card.appendChild(answersDiv);

    // optional meta area: show original question number
    const meta = document.createElement('div');
    meta.className = 'meta';
    const origLabel = document.createElement('div');
    origLabel.textContent = `#${item.originalIndex+1}`;
    meta.appendChild(origLabel);
    card.appendChild(meta);

    container.appendChild(card);
  });

  // clear previous result
  document.getElementById('resultText').textContent = '';
}

/* show correct for one card */
function showCorrectForCard(cardEl, origIndex){
  const key = kluc[origIndex]; // string like 'SNNN'
  const labels = [...cardEl.querySelectorAll('label.ans')];
  // Determine which shuffled labels correspond to which original index
  labels.forEach(label=>{
    const origAnsIdx = parseInt(label.dataset.origAnswerIdx,10); // 0..3
    const isCorrect = key[origAnsIdx] === 'S';
    const input = label.querySelector('input');
    const checked = input.checked;
    // Reset classes first
    label.classList.remove('correct','incorrect');
    if(isCorrect && checked) {
      label.classList.add('correct');
    } else if(isCorrect && !checked){
      // correct but not selected -> mark red (as requested)
      label.classList.add('incorrect');
    } else if(!isCorrect && checked){
      // wrong selected -> red
      label.classList.add('incorrect');
    }
    // else not correct and not selected -> keep default
  });
}

/* show all correct answers globally */
function showAllCorrect(){
  const cards = document.querySelectorAll('.card');
  cards.forEach(card=>{
    const origIndex = parseInt(card.dataset.orig,10);
    showCorrectForCard(card, origIndex);
  });
}

/* evaluate current shown questions */
function evaluateAll(){
  const cards = document.querySelectorAll('.card');
  let correctCount = 0;
  const wrongList = [];
  cards.forEach(card=>{
    const origIndex = parseInt(card.dataset.orig,10);
    const key = kluc[origIndex]; // e.g. 'SNNN'
    const labels = [...card.querySelectorAll('label.ans')];
    const selectedOrigIdx = labels.filter(lbl=> lbl.querySelector('input').checked ).map(lbl=> parseInt(lbl.dataset.origAnswerIdx,10));
    // compute sets
    const selSet = new Set(selectedOrigIdx);
    const corrSet = new Set();
    for(let i=0;i<4;i++) if(key[i]==='S') corrSet.add(i);
    // Compare exact equality
    let equal = (selSet.size === corrSet.size);
    if(equal){
      for(let v of selSet) if(!corrSet.has(v)){ equal=false; break; }
    }
    // mark colors for visual feedback
    labels.forEach(label=>{
      label.classList.remove('correct','incorrect');
      const origAnsIdx = parseInt(label.dataset.origAnswerIdx,10);
      const isCorrect = key[origAnsIdx] === 'S';
      const checked = label.querySelector('input').checked;
      if(isCorrect && checked) label.classList.add('correct');
      else if(isCorrect && !checked) label.classList.add('incorrect');
      else if(!isCorrect && checked) label.classList.add('incorrect');
    });

    if(equal){
      correctCount++;
    } else {
      wrongList.push(origIndex);
    }
  });

  // store last wrong set for retry/filters
  state.lastWrongSet = wrongList.slice();

  // percent relative to number of displayed questions
  const total = cards.length;
  const percent = total === 0 ? 0 : ((correctCount/total)*100).toFixed(2);
  document.getElementById('resultText').textContent = `Úspešnosť: ${percent}% (${correctCount}/${total} úplne správnych otázok)`;
}

/* Show only wrong questions (filter) */
function showOnlyWrong(){
  if(state.lastWrongSet.length === 0){
    alert('Nie sú uložené žiadne chybné otázky (vyhodnoť test najprv).');
    return;
  }
  state.filter = 'wrong';
  renderQuestions();
}

/* Reset test to initial state (all questions, clear selections, clear coloring) */
function resetTest(){
  // reinitialize questions to default order and answers order
  state.filter = 'all';
  state.lastWrongSet = [];
  // restore original questions order (as in questions array)
  state.questions = questions.map((q,i)=>{
    const answers = q.a.map((txt, idx)=>({txt, idx}));
    return { originalIndex:i, qtext:q.q, answers };
  });
  // clear favorites stays preserved
  renderQuestions();
  document.getElementById('resultText').textContent = '';
}

/* Retry only wrong questions (renders only wrong set but allows answering them) */
function retryWrong(){
  if(state.lastWrongSet.length === 0){
    alert('Žiadne chybné otázky pre opakovanie. Najprv vyhodnoť test.');
    return;
  }
  // Build state.questions to include only wrong ones, preserving originalIndex
  state.questions = state.lastWrongSet.map(idx => {
    const q = questions[idx];
    const answers = q.a.map((txt, ai)=>({txt, idx:ai}));
    return { originalIndex: idx, qtext: q.q, answers };
  });
  state.filter = 'all';
  renderQuestions();
  document.getElementById('resultText').textContent = '';
}

/* Show only favorites */
function showFavoritesOnly(){
  state.filter = 'favorites';
  renderQuestions();
}

/* Show all questions (clear filters) */
function showAllQuestions(){
  state.filter = 'all';
  // restore full set in original order
  state.questions = questions.map((q,i)=>({ originalIndex:i, qtext:q.q, answers: q.a.map((txt, idx)=>({txt, idx})) }));
  renderQuestions();
}

/* Shuffle questions (random order) and shuffle answers within each question */
function shuffleQuestions(){
  // shuffle questions array
  const arr = questions.map((q,i)=>({ originalIndex:i, qtext:q.q, answers: q.a.map((txt, idx)=>({txt, idx})) }));
  const shuffled = shuffleArr(arr);
  state.questions = shuffled;
  state.filter = 'all';
  renderQuestions();
}

/* Show Favorites modal/list (simple behavior: filter to favorites) */
function showFavoritesList(){
  // if no favorites, inform
  if(state.favorites.size === 0){
    alert('Nemáš označené žiadne obľúbené otázky.');
    return;
  }
  state.filter = 'favorites';
  // prepare state.questions as full list so filter works
  state.questions = questions.map((q,i)=>({ originalIndex:i, qtext:q.q, answers: q.a.map((txt, idx)=>({txt, idx})) }));
  renderQuestions();
}

/* Show only wrong (button at bottom) identical to showOnlyWrong function but filters current display */
function showOnlyWrongButton(){
  showOnlyWrong();
}

/* Attach event listeners */
document.getElementById('btnShowAll').addEventListener('click', showAllCorrect);
document.getElementById('btnShuffle').addEventListener('click', ()=>{ shuffleQuestions(); });
document.getElementById('btnFavorites').addEventListener('click', showFavoritesList);
document.getElementById('btnShowAllQ').addEventListener('click', showAllQuestions);
document.getElementById('btnShowWrongOnly').addEventListener('click', ()=>{ state.filter = 'wrong'; renderQuestions(); });
document.getElementById('btnShowFavOnly').addEventListener('click', showFavoritesOnly);
document.getElementById('btnEvaluate').addEventListener('click', evaluateAll);
document.getElementById('btnShowWrong').addEventListener('click', showOnlyWrongButton);
document.getElementById('btnRetryWrong').addEventListener('click', retryWrong);
document.getElementById('btnReset').addEventListener('click', resetTest);

/* Initialize on load */
initQuestions();
</script>
</body>
</html>
