<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>13. Vzťahy medzi mikro a makroorganizmami</title>
<style>
  :root{
	--card-bg: #F2D9DA;      /* bledožlté pozadie kariet */
	--accent: #800000;       /* žltý akcent pre tlačidlá */
    --good: #c8f7d0;
    --bad: #ffd6d6;
	--correct-unchecked: #c8f7d0;
    --card-radius: 14px;
  }
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: #FFFFFF;
    color:#111;body{
  background: 
}
    padding:30px 16px;
    display:flex;
    justify-content:center;
  }
  .wrap{
    width:100%;
    max-width:1100px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:18px;
  }
  h1{
    margin:0;
    font-size:22px;
  }
  .top-controls{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  button{
    background:var(--accent);
    color:white;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
  }
  button.secondary{
    background:#6c757d;
  }
  .center-controls{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-bottom:14px;
  }
  #quiz{
    display:flex;
    flex-direction:column;
    gap:14px;
    align-items:center;
  }
  .card{
    width:100%;
    max-width:980px;
    background:var(--card-bg);
    border-radius:var(--card-radius);
	border: 2px solid #800000;  /* žltý rámik */
    padding:16px 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    display:block;
    box-sizing:border-box;
    position:relative;
  }
  .q-header{
    display:flex;
    align-items:flex-start;
    gap:10px;
  }
  .q-number{
    font-weight:700;
    min-width:34px;
  }
  .q-text{
    font-weight:700;
    flex:1;
  }
  .q-actions{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .star{
    font-size:20px;
    cursor:pointer;
    user-select:none;
    color:rgba(0,0,0,0.25);
  }
  .star.active{ color: gold; text-shadow: 0 0 6px rgba(255,215,0,0.4); }
  .answers{
    margin-top:10px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  label.ans{
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    padding:8px;
    border-radius:8px;
  }
  label.ans input{ transform:scale(1.05); }
  .btn-small{
    padding:6px 10px;
    font-size:13px;
    border-radius:8px;
    background:#0b84ff;
  }
  .btn-show{
    background:#0b84ff;
    color:white;
    border-radius:8px;
    padding:6px 10px;
    font-size:13px;
  }
  .meta{
    display:flex;
    gap:12px;
    align-items:center;
    font-size:13px;
    margin-top:10px;
    color:#333;
  }
  .result{
    text-align:center;
    margin-top:18px;
    font-weight:700;
    font-size:16px;
  }
  .controls-bottom{
    display:flex;
    gap:8px;
    justify-content:center;
    margin-top:18px;
    flex-wrap:wrap;
  }
  .hidden{ display:none; }
  /* coloring for showCorrect */
  .correct { background: var(--good) !important; }
  .incorrect { background: var(--bad) !important; }
  .correct-unchecked { background: var(--correct-unchecked) !important; }
  /* small responsive */
  @media (max-width:640px){
    body { padding:14px; }
    .card{ padding:12px; }
    .q-number{ min-width:28px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>13. Vzťahy medzi mikro a makroorganizmami</h1>
    <div class="top-controls">
      <button id="btnFavorites">Obľúbené</button>
      <button id="btnShuffle">Zamiešať otázky</button>
      <button id="btnShowAll" title="Zobraziť všetky správne odpovede">Zobraziť všetky správne odpovede</button>
    </div>
  </header>

  <div class="center-controls">
    <span style="color:#555">Filtrovať zobrazenie:</span>
    <button id="btnShowAllQ" class="secondary">Zobraziť všetky</button>
    <button id="btnShowWrongOnly" class="secondary">Zobraziť len chybné</button>
    <button id="btnShowFavOnly" class="secondary">Zobraziť len obľúbené</button>
  </div>

  <div id="quiz"></div>

  <div class="controls-bottom">
    <button id="btnEvaluate">Vyhodnotiť všetko</button>
    <button id="btnShowWrong">Zobraziť len chybné otázky</button>
    <button id="btnRetryWrong">Opakovať len chybné</button>
    <button id="btnReset">Obnoviť test</button>
  </div>

  <div class="result" id="resultText"></div>
</div>

<script>
const questions = [
{ id: 1, text: "Baktérie sú:", answers: ["nebunkové patogény ľudí", "bunkové patogény ľudí", "eukaryotické mikroorganizmy", "prokaryotické mikroorganizmy"], key: "NSNS" },
{ id: 2, text: "Veľkosť baktérií je:", answers: ["rádovo porovnateľná s veľkosťou ľudskej eukaryotickej bunky", "nie je rádovo porovnateľná s veľkosťou ľudskej eukaryotickej bunky", "meraná v μm", "meraná v mm"], key: "NSSN" },
{ id: 3, text: "Z hľadiska vzťahu baktérií ku kyslíku platí, že:", answers: ["aeróbne baktérie na svoju existenciu nevyžadujú kyslík", "anaeróbne baktérie na svoju existenciu vyžadujú kyslík", "na anaeróbne baktérie pôsobí kyslík toxicky", "aeróbne baktérie na svoju existenciu vyžadujú kyslík"], key: "NNSS" },
{ id: 4, text: "Ktoré baktérie trvalo žijú v hrubom čreve?", answers: ["kvasné baktérie", "Escherichia coli", "hnilobné baktérie", "nepatogénne baktérie"], key: "SSSS" },
{ id: 5, text: "Baktérie možno nájsť:", answers: ["na povrchu organizmov", "v krvi zdravého človeka", "v bakteriofágoch", "v hrubom čreve človeka"], key: "SNNS" },
{ id: 6, text: "Baktérie vyvolávajú:", answers: ["besnotu", "tuberkulózu", "detské kiahne", "tetanus"], key: "NSNS" },
{ id: 7, text: "Mikroskopické huby:", answers: ["sú prokaryotické organizmy", "sú heterotrofné organizmy", "sú schopné fotosyntézy", "sú eukaryotické organizmy"], key: "NSNS" },
{ id: 8, text: "Prvé antibiotikum bolo:", answers: ["izolované z vírusu", "penicilín", "produkované druhom Penicillium notatum", "vankomycín"], key: "NSSN" },
{ id: 9, text: "Spóra bakteriálnej bunky sa od materskej bunky odlišuje:", answers: ["rozdielnym obsahom vody", "vnímavosťou k činiteľom vonkajšieho prostredia", "aktivitou látkovej výmeny", "taxonomickým zaradením"], key: "SSSN" },
{ id: 10, text: "Najznámejšími bakteriálnymi pôvodcami pohlavných ochorení sú:", answers: ["Salmonella", "Mycobacterium tuberculosis", "Treponema pallidum", "Neisseria gonorrhoeae"], key: "NNSS" },
{ id: 11, text: "Pôvodcami respiračných bakteriálnych infekcií sú zástupcovia rodov:", answers: ["Salmonella", "Mycobacterium tuberculosis", "Treponema", "Escherichia"], key: "NSNN" },
{ id: 12, text: "Patogénne baktérie môžu spôsobovať:", answers: ["Salmonelózu", "Choleru", "ovčie kiahne", "osýpky"], key: "SSNN" },
{ id: 13, text: "Pôvodcami ťažkých bakteriálnych hnačkových ochorení sú zástupcovia rodov:", answers: ["Salmonella", "Mycobacterium", "Shigella", "Escherichia"], key: "SNSS" },
{ id: 14, text: "Plazmid:", answers: ["je bakteriálna bunka schopná sama vyrobiť", "vie bakteriálna bunka získať od inej bunky", "stráca donorová bakteriálna bunka počas konjugácie", "je počas konjugácie replikovaný, donorová bakteriálna bunka ho nestráca"], key: "NSNS" },
{ id: 15, text: "Plazmidom môže byť podmienená:", answers: ["Rezistencia na antibiotiká, chemoterapeutiká a ťažké kovy", "Replikácia bakteriálneho genómu", "Produkcia antibiotík a toxínov", "Degradácia a oxidácia inak biologicky inertných alebo toxických organických látok"], key: "SNSS" },
{ id: 16, text: "Genotypové metódy na sledovanie rezistencie baktérií na antibiotiká:", answers: ["predpovedajú iba rezistenciu, nie sú kvantifikovateľné", "dokážu zachytiť nové, novo sa vyskytujúce, dosiaľ neznáme genetické determinanty", "predpovedajú rezistencie a nové varianty známych génov rezistencie", "nezachytávajú gény rezistencie bez fenotypového prejavu"], key: "SNNN" },
{ id: 17, text: "Farbenie podľa Grama umožňuje:", answers: ["farbenie spór baktérií", "farbenie deliacich sa buniek", "identifikáciu fakultatívne anaeróbnych baktérií", "identifikovať bunky infikované vírusom"], key: "NNNN" },
{ id: 18, text: "Plazmidom môže byť podmienená:", answers: ["Tvorba reštrikčných a modifikačných enzýmov", "Tvorba jadrovej membrány baktérií", "Schopnosť symbiózy", "Syntéza membránových organel baktérií"], key: "SNSN" },
{ id: 19, text: "Prenos plazmidu z bunky do bunky:", answers: ["delíme na horizontálny a vertikálny", "horizontálny sa deje aj medzi rôznymi druhmi a rodmi baktérií", "vertikálny sa deje aj medzi rôznymi druhmi a rodmi baktérií", "sa deje aj počas amitózy"], key: "SSNS" },
{ id: 20, text: "Horizontálny prenos plazmidu z bunky do bunky:", answers: ["sa deje počas amitózy z materskej na dcérske bunky", "prebieha len medzi rovnakými rodmi baktérií", "je zodpovedný za medzidruhový a medzirodový transfer rezistencie na antibiotiká", "prebieha prostredníctvom konjugácie"], key: "NNSS" },
{ id: 21, text: "Ciele účinku antimikrobiálnych látok sú:", answers: ["bunková stena", "lyzozómy", "endoplazmatické retikulum", "replikácia a transkripcia"], key: "SNNS" },
{ id: 22, text: "Narušenie mikrobiómu sa spája s:", answers: ["chronickými zápalmi hrubého čreva", "autizmom", "obezitou", "autoimunitnými ochoreniami"], key: "SSSS" },
{ id: 23, text: "Entamoeba histolytica – forma minuta:", answers: ["tvorí štvorjadrové cysty", "nevytvára cysty", "je vysoko patogénna", "vyskytuje sa ako trofozoit"], key: "SNNS" },
{ id: 24, text: "Entamoeba histolytica:", answers: ["človek sa najčastejšie infikuje alimentárnou cestou zrelými štvorjadrovými cystami", "je to jediná patogénna améba žijúca v tráviacom systéme človeka", "parazituje v tenkom čreve", "parazituje v hrubom čreve"], key: "SSNS" },
{ id: 25, text: "Eumikróbia je:", answers: ["optimálny pomer zastúpenia mikroorganizmov v biocenóze", "premnoženie patogénnych mikroorganizmov v organizme človeka", "stav, pri ktorom prišlo k narušeniu rovnováhy medzi mikroorganizmami prirodzenej mikroflóry", "chýbanie niektorých mikroorganizmov, ktoré tvoria súčasť bežnej mikroflóry u človeka"], key: "SNNN" },
{ id: 26, text: "Giardia intestinalis:", answers: ["parazituje v dvanástniku a v hornej časti tenkého čreva", "je bičíkovec", "parazituje v hrubom čreve človeka", "má guľovitý tvar"], key: "SSNN" },
{ id: 27, text: "Giardióza sa najčastejšie prejavuje:", answers: ["anémiou, nedostatkom Fe", "malabsorbčným syndrómom", "prítomnosťou hlienu a tukov v stolici", "prítomnosťou krvi v stolici"], key: "NSSN" },
{ id: 28, text: "Medzi dutinové parazitické protozoa patrí:", answers: ["Toxoplasma gondii", "Entamoeba histolytica", "Trichomonas vaginalis", "Plasmodium malaria"], key: "NSSN" },
{ id: 29, text: "Patogénnosť:", answers: ["je schopnosť mikroorganizmu vyvolať ochorenie u hostiteľa", "je schopnosť mikroorganizmu vyvolať ochorenie u každého hostiteľa", "oportúnne patogénny vyvolávajú ochorenie iba za určitých špecifických podmienok, kde ich telo nevie tolerovať alebo pri imunodeficiencii", "je vlastnosťou všetkých mikroorganizmov"], key: "SNSN" },
{ id: 30, text: "Pôvodcom trojdňovej malárie je:", answers: ["Plasmodium falciparum", "Plasmodium vivax", "Plasmodium malariae", "Plasmodium ovale"], key: "NSNS" },
{ id: 31, text: "Trofozoity Toxoplazma gondii sa vyskytujú v dvoch formách:", answers: ["pseudocysty", "tachyzoity", "tkanivové cysty", "bradyzoity"], key: "NSNS" },
{ id: 32, text: "Z bunkovej membrány parazitických prvokov môžu vyrastať:", answers: ["bičíky", "cílie", "panôžky", "undulujúce membrány"], key: "SSSS" },
{ id: 33, text: "Čo najlepšie vystihuje pojem „dysbióza“?", answers: ["stav, keď je mikrobiota v rovnováhe (eumikróbia)", "narušenie zloženia mikrobioty spojené s rizikom chorôb", "prítomnosť len obligátne patogénnych mikróbov v čreve", "úplná absencia mikroorganizmov v ľudskom tele"], key: "NSNN" },
{ id: 34, text: "Ktorý príklad najlepšie ilustruje oportunistickú infekciu?", answers: ["cholera po nákaze Vibrio cholerae v pitnej vode", "zápal močových ciest spôsobený E. coli po zavedení katétra", "týfus po nákaze Salmonella typhi", "osýpky po kontakte s infikovanou osobou"], key: "NSNN" },
{ id: 35, text: "Ktorý pojem označuje narušenie zloženia črevnej mikrobioty?", answers: ["eumikróbia", "patogénnosť", "dysbióza", "komenzalizmus"], key: "NNSN" },
{ id: 36, text: "Aký je rozdiel medzi obligátnym a oportúnnym patogénom?", answers: ["obligátny patogén vyvoláva ochorenie takmer vždy", "oportúnny patogén spôsobuje ochorenie najmä pri oslabení imunity alebo v netypickom prostredí", "obligátny patogén je vždy prítomný v čreve", "oportúnny patogén sa vyskytuje výlučne u detí"], key: "SSNN" },
{ id: 37, text: "Čo označuje pojem premorenosť populácie?", answers: ["mieru závažnosti priebehu infekcie", "schopnosť mikroorganizmu vyvolať ochorenie", "podiel osôb v populácii nakazených určitým parazitom alebo patogénom", "dôležitý epidemiologický ukazovateľ vysvetľujúci lokálne rozdiely v chorobnosti"], key: "NNSS" },
{ id: 38, text: "Čo znamenajú pojmy eumikróbia a dysbióza?", answers: ["eumikróbia je rovnovážne zloženie mikrobioty", "dysbióza je narušenie rovnováhy mikrobioty spojené s rôznymi ochoreniami", "eumikróbia je stav, keď hostiteľ nemá žiadne mikroorganizmy", "dysbióza označuje schopnosť mikroorganizmu vyvolať ochorenie"], key: "SSNN" },
{ id: 39, text: "Ako možno charakterizovať komenzala a symbionta?", answers: ["komenzal žije na povrchu alebo vnútri hostiteľa bez toho, aby mu škodil", "symbiont je mikroorganizmus, ktorý je vždy patogénny", "symbiont žije v stabilnom vzťahu prospešnom pre obe strany", "komenzal je mikroorganizmus, ktorý vždy vyvoláva ochorenie"], key: "SNSN" },
{ id: 40, text: "Ako sa môžu usporadúvať koky?", answers: ["ako diplokoky – dvojice gulovitých baktérií", "ako vibria – zahnuté baktérie", "ako bacily – paličkovité baktérie", "ako streptokoky – reťazce gulovitých baktérií"], key: "SNNS" },
{ id: 41, text: "Ktoré z nasledujúcich patria medzi špirálovité baktérie?", answers: ["vibria – špirálovité bunky", "spirily – špirálovité bunky", "stafylokoky – špirálovité hroznovité zhluky", "bacily – rovné alebo zakrivené špirály"], key: "NSNN" },
{ id: 42, text: "Ktoré baktérie vyžadujú prítomnosť kyslíka pre svoj rast a metabolizmus?", answers: ["obligátne aeróby", "obligátne anaeróby", "fakultatívne anaeróby", "aerotolerantné anaeróby"], key: "SNNN" },
{ id: 43, text: "Ktoré baktérie prežívajú aj v prítomnosti kyslíka, ale ho nevyužívajú na metabolizmus?", answers: ["mikroaerofily", "fakultatívne anaeróby", "aerotolerantné anaeróby", "obligátne aeróby"], key: "NNSN" },
{ id: 44, text: "Priraď typ baktérie k jej vzťahu ku kyslíku:", answers: ["obligátny aerób – rast len pri neprítomnosti kyslíka", "obligátny anaerób – kyslík je toxický", "fakultatívny anaerób – rast s kyslíkom aj bez neho", "mikroaerofil – optimálny rast pri nízkej koncentrácii kyslíka"], key: "NSSS" },
{ id: 45, text: "Ktoré tvrdenia o protozoách sú správne?", answers: ["sú prokaryotické jednobunkovce", "sú eukaryotické a heterotrofné", "nikdy netvoria cysty", "môžu sa pohybovať bičíkmi, riasinkami alebo panôžkami"], key: "NSNS" },
{ id: 46, text: "Aké metódy sa využívajú pri diagnostike protozoálnych infekcií?", answers: ["len kultivácia na živných pôdach", "mikroskopické vyšetrenie natívnych alebo farbených preparátov", "imunologické testy", "metódy molekulárnej biológie"], key: "NSSS" },
{ id: 47, text: "Ktoré tvrdenia o Trichomonas vaginalis sú správne?", answers: ["je najväčší ľudský bičíkovec", "spôsobuje rektálnu vaginitídu", "má hruškovitý tvar a 5 bičíkov", "má axiálny axostyl"], key: "NNSS" },
{ id: 48, text: "Narušenie mikrobiómu sa spája s:", answers: ["chronickými zápalmi hrubého čreva", "pes equinovarus", "obezitou", "autoimunitnými ochoreniami"], key: "SNSS" },
{ id: 49, text: "Kde sa baktérie za normálnych okolností u zdravého človeka nenachádzajú?", answers: ["v koži", "v čreve", "v krvi", "v ústnej dutine"], key: "NNSN" },
{ id: 50, text: "Ktorý mikroorganizmus je pôvodcom tuberkulózy?", answers: ["Mycobacterium tuberculosis", "Neisseria gonorrhoeae", "Clostridium tetani", "Salmonella typhi"], key: "SNNN" },
{ id: 51, text: "Ktorá baktéria je pôvodcom syfilisu?", answers: ["Shigella dysenteriae", "Treponema pallidum", "Escherichia coli", "Vibrio cholerae"], key: "NSNN" },
{ id: 52, text: "Ako účinkuje botulotoxín na organizmus?", answers: ["stimuluje uvoľňovanie acetylcholínu v synapsách", "blokuje nervovosvalový prenos a spôsobuje paralýzu", "podporuje delenie nervových buniek", "rozkladá fosfolipidy bunkovej membrány"], key: "NSNN" },
{ id: 53, text: "Ktoré druhy plazmódií sú schopné vytvárať hypnozoity a spôsobovať relapsy malárie?", answers: ["P. falciparum a P. malariae", "P. vivax a P. ovale", "P. falciparum a P. vivax", "P. malariae a P. ovale"], key: "NSNN" },
{ id: 54, text: "Ktoré zo štádií Toxoplasma gondii sú správne priradené k ich úlohe v infekcii?", answers: ["sporozoity – prenos komárom", "bradyzoity – chronická latentná fáza v tkanivových cystách", "hypnozoity – prežívanie vo svalových bunkách", "tachyzoity – akútna fáza infekcie"], key: "NSNS" },
{ id: 55, text: "Ktoré vývojové štádiá patria k jednotlivým rodovým druhom parazitov?", answers: ["hypnozoity – Plasmodium vivax a Plasmodium ovale", "sporozoity – infekčná forma Plasmodium prenášaná komárom", "tachyzoity – rýchlo sa deliace formy Toxoplasma gondii", "bradyzoity – latentné formy Plasmodium falciparum"], key: "SSSN" },
{ id: 56, text: "Priraď vírus k spôsobu využitia alebo vlastnosti:", answers: ["retrovírusy – trvalá integrácia cudzej DNA do genómu hostiteľa", "adenovírusy – dočasná expresia génov s výraznou integráciou", "adeno – asociované vírusy – vysoká bezpečnosť a nízka imunogenicita", "vírus besnoty – bežne používaný v génovom inžinierstve"], key: "SNSN" },
{ id: 57, text: "Priraď ochorenie k pôvodcovi:", answers: ["tuberkulóza – Mycobacterium tuberculosis", "tetanus – Treponema pallidum", "syfilis – Treponema pallidum", "kvapavka – Clostridium tetani"], key: "SNSN" },
{ id: 58, text: "Priraď ochorenie k pôvodcovi:", answers: ["salmonelóza – Salmonella enterica", "ťažké hnačkové ochorenia – Neisseria gonorrhoeae", "enteropatogénne infekcie – Escherichia coli", "botulizmus – Shigella dysenteriae"], key: "SNSN" },
{ id: 59, text: "Priraď ochorenie k pôvodcovi:", answers: ["toxoplazmóza – Toxoplasma gondii", "malária – Clostridium botulinum", "malária s relapsmi – Plasmodium vivax", "krvné cysty – tachyzoity Toxoplasma gondii"], key: "SNSN" },
{ id: 60, text: "Priraď ochorenie k pôvodcovi:", answers: ["HIV – získaný syndróm imunitnej nedostatočnosti", "vírus besnoty – respiračné infekcie", "adenovírusy – hepatitída B", "retrovírus HTLV – 1 – leukémia T – lymfocytov"], key: "SNNS" }

];


const key = [
"NSNS","NSSN","NNSS","SSSS","SNNS","NSNS","NSNS","NSSN","SSSN","NNSS",
"NSNN","SSNN","SNSS","NSNS","SNSS","SNNN","NNNN","SNSN","SSNS","NNSS",
"SNNS","SSSS","SNNS","SSNS","SNNN","SSNN","NSSN","NSSN","SNSN","NSNS",
"NSNS","SSSS","NSNN","NSNN","NNSN","SSNN","NNSS","SSNN","SNSN","SNNS",
"NSNN","SNNN","NNSN","NSSS","NNSS","SNSS","NNSN","SNNN","NNSN","SNNN",
"NSNN","NSNN","NSNN","NSNS","SSSN","SNSN","SNSN","SNSN","SNSN","SNNS"
];



/* ------------------ State ------------------ */
let state = {
  questions: [], // will hold questions with original index and randomized answers
  filter: 'all', // 'all', 'wrong', 'favorites'
  favorites: new Set(),
  lastWrongSet: [], // store wrong questions for retry
};

/* Initialize questions with originalIndex and random answer order */
function initQuestions(){
  state.questions = questions.map((q,i)=>{
    const originalIndex = i; // 0-based
    const answers = q.answers.map((txt, idx)=>({txt, idx}));
    return { originalIndex, qtext: q.text, answers };
  });
  renderQuestions();
}

/* Utility shuffle */
function shuffleArr(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* Render current state.questions according to filter */
function renderQuestions(){
  const container = document.getElementById('quiz');
  container.innerHTML = '';
  let toRender = state.questions.slice();

  // apply filter
  if(state.filter === 'favorites'){
    toRender = toRender.filter(item => state.favorites.has(item.originalIndex));
  } else if(state.filter === 'wrong'){
    toRender = toRender.filter(item => state.lastWrongSet.includes(item.originalIndex));
  }

  if(toRender.length === 0){
    const info = document.createElement('div');
    info.style.textAlign='center';
    info.style.color='#555';
    info.style.margin='18px';
    info.textContent = 'Žiadne otázky na zobrazenie.';
    container.appendChild(info);
    document.getElementById('resultText').textContent = '';
    return;
  }

  toRender.forEach((item, displayIdx)=>{
    // build card
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.orig = item.originalIndex;

    // header
    const header = document.createElement('div');
    header.className = 'q-header';

    const num = document.createElement('div');
    num.className = 'q-number';
    num.textContent = (displayIdx+1)+'.';

    const text = document.createElement('div');
    text.className = 'q-text';
    text.textContent = item.qtext;

    const actions = document.createElement('div');
    actions.className = 'q-actions';

    // star favorite
    const star = document.createElement('div');
    star.className = 'star';
    star.title = 'Označiť ako obľúbené';
    star.innerHTML = state.favorites.has(item.originalIndex) ? '★' : '☆';
    if(state.favorites.has(item.originalIndex)) star.classList.add('active');
    star.addEventListener('click', ()=>{
      if(state.favorites.has(item.originalIndex)){
        state.favorites.delete(item.originalIndex);
        star.classList.remove('active');
        star.innerHTML = '☆';
      } else {
        state.favorites.add(item.originalIndex);
        star.classList.add('active');
        star.innerHTML = '★';
      }
    });

    // show correct button
    const btnShow = document.createElement('button');
    btnShow.className = 'btn-small btn-show';
    btnShow.textContent = 'Zobraziť správne';
    btnShow.addEventListener('click', ()=> showCorrectForCard(card, item.originalIndex));

    actions.appendChild(star);
    actions.appendChild(btnShow);

    header.appendChild(num);
    header.appendChild(text);
    header.appendChild(actions);

    card.appendChild(header);

    // randomize answer order for display (store mapping)
    const randomized = item.answers.slice();
    // If answers not yet shuffled for this render, shuffle them each render
    const shuffledAnswers = shuffleArr(randomized);
    card._shuffled = shuffledAnswers.map(a=>a.idx); // store original idx order

    // answers block
    const answersDiv = document.createElement('div');
    answersDiv.className = 'answers';

    shuffledAnswers.forEach((ansObj, ansPos)=>{
      const label = document.createElement('label');
      label.className = 'ans';
      label.dataset.origAnswerIdx = ansObj.idx; // 0..3 original index
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.name = `q_${item.originalIndex}`;
      checkbox.value = ansObj.idx;
      label.appendChild(checkbox);
      const span = document.createElement('span');
      span.textContent = ansObj.txt;
      label.appendChild(span);
      answersDiv.appendChild(label);
    });

    card.appendChild(answersDiv);

    // optional meta area: show original question number
    const meta = document.createElement('div');
    meta.className = 'meta';
    const origLabel = document.createElement('div');
    origLabel.textContent = `#${item.originalIndex+1}`;
    meta.appendChild(origLabel);
    card.appendChild(meta);

    container.appendChild(card);
  });

  // clear previous result
  document.getElementById('resultText').textContent = '';
}

/* show correct for one card */
function showCorrectForCard(cardEl, origIndex){
  const key = questions[origIndex].key; // string like 'SNNN'
  const labels = [...cardEl.querySelectorAll('label.ans')];
  // Determine which shuffled labels correspond to which original index
  labels.forEach(label=>{
    const origAnsIdx = parseInt(label.dataset.origAnswerIdx,10); // 0..3
    const isCorrect = key[origAnsIdx] === 'S';
    const input = label.querySelector('input');
    const checked = input.checked;
    // Reset classes first
    label.classList.remove('correct','incorrect');
    if(isCorrect && checked) {
      label.classList.add('correct');
    } else if(isCorrect && !checked){
      // correct but not selected -> mark blue (as requested)
      label.classList.add('correct-unchecked'); // modrá
    } else if(!isCorrect && checked){
      // wrong selected -> red
      label.classList.add('incorrect');
    }
    // else not correct and not selected -> keep default
  });
}

/* show all correct answers globally */
function showAllCorrect(){
  const cards = document.querySelectorAll('.card');
  cards.forEach(card=>{
    const origIndex = parseInt(card.dataset.orig,10);
    showCorrectForCard(card, origIndex);
  });
}

/* evaluate current shown questions */
function evaluateAll(){
  const cards = document.querySelectorAll('.card');
  let correctCount = 0;
  const wrongList = [];
  cards.forEach(card=>{
    const origIndex = parseInt(card.dataset.orig,10);
    const key = questions[origIndex].key; // e.g. 'SNNN'
    const labels = [...card.querySelectorAll('label.ans')];
    const selectedOrigIdx = labels.filter(lbl=> lbl.querySelector('input').checked ).map(lbl=> parseInt(lbl.dataset.origAnswerIdx,10));
    // compute sets
    const selSet = new Set(selectedOrigIdx);
    const corrSet = new Set();
    for(let i=0;i<4;i++) if(key[i]==='S') corrSet.add(i);
    // Compare exact equality
    let equal = (selSet.size === corrSet.size);
    if(equal){
      for(let v of selSet) if(!corrSet.has(v)){ equal=false; break; }
    }
    // mark colors for visual feedback
    labels.forEach(label=>{
      label.classList.remove('correct','incorrect');
      const origAnsIdx = parseInt(label.dataset.origAnswerIdx,10);
      const isCorrect = key[origAnsIdx] === 'S';
      const checked = label.querySelector('input').checked;
      if(isCorrect && checked) label.classList.add('correct');
      else if(isCorrect && !checked) label.classList.add('incorrect');
      else if(!isCorrect && checked) label.classList.add('incorrect');
    });

    if(equal){
      correctCount++;
    } else {
      wrongList.push(origIndex);
    }
  });

  // store last wrong set for retry/filters
  state.lastWrongSet = wrongList.slice();

  // percent relative to number of displayed questions
  const total = cards.length;
  const percent = total === 0 ? 0 : ((correctCount/total)*100).toFixed(2);
  document.getElementById('resultText').textContent = `Úspešnosť: ${percent}% (${correctCount}/${total} úplne správnych otázok)`;
}

/* Show only wrong questions (filter) */
function showOnlyWrong(){
  if(state.lastWrongSet.length === 0){
    alert('Nie sú uložené žiadne chybné otázky (vyhodnoť test najprv).');
    return;
  }

  // uloženie všetkých označených odpovedí pred renderom
  const savedAnswers = {};
  document.querySelectorAll('.card').forEach(card=>{
    const qIndex = parseInt(card.dataset.orig,10);
    savedAnswers[qIndex] = [];
    card.querySelectorAll('input[type="checkbox"]').forEach((chk, i)=>{
      if(chk.checked) savedAnswers[qIndex].push(parseInt(chk.value,10));
    });
  });

  state.filter = 'wrong';
  renderQuestions();

  // po rerendere obnov výbery
  document.querySelectorAll('.card').forEach(card=>{
    const qIndex = parseInt(card.dataset.orig,10);
    if(savedAnswers[qIndex]){
      card.querySelectorAll('input[type="checkbox"]').forEach(chk=>{
        const val = parseInt(chk.value,10);
        if(savedAnswers[qIndex].includes(val)) chk.checked = true;
      });
    }
  });
}

/* Reset test to initial state (all questions, clear selections, clear coloring) */
function resetTest(){
  // reinitialize questions to default order and answers order
  state.filter = 'all';
  state.lastWrongSet = [];
  // restore original questions order (as in questions array)
  state.questions = questions.map((q,i)=>{
    const answers = q.answers.map((txt, idx)=>({txt, idx}));
    return { originalIndex:i, qtext:q.text, answers };
  });
  // clear favorites stays preserved
  renderQuestions();
  document.getElementById('resultText').textContent = '';
}

/* Retry only wrong questions (renders only wrong set but allows answering them) */
function retryWrong(){
  if(state.lastWrongSet.length === 0){
    alert('Žiadne chybné otázky pre opakovanie. Najprv vyhodnoť test.');
    return;
  }
  // Build state.questions to include only wrong ones, preserving originalIndex
  state.questions = state.lastWrongSet.map(idx => {
    const q = questions[idx];
    const answers = q.answers.map((txt, ai)=>({txt, idx:ai}));
    return { originalIndex: idx, qtext: q.text, answers };
  });
  state.filter = 'all';
  renderQuestions();
  document.getElementById('resultText').textContent = '';
}

/* Show only favorites */
function showFavoritesOnly(){
  state.filter = 'favorites';
  renderQuestions();
}

/* Show all questions (clear filters) */
function showAllQuestions(){
  state.filter = 'all';
  // restore full set in original order
  state.questions = questions.map((q,i)=>({ originalIndex:i, qtext:q.text, answers: q.answers.map((txt, idx)=>({txt, idx})) }));
  renderQuestions();
}

/* Shuffle questions (random order) and shuffle answers within each question */
function shuffleQuestions(){
  // shuffle questions array
  const arr = questions.map((q,i)=>({ originalIndex:i, qtext:q.text, answers: q.answers.map((txt, idx)=>({txt, idx})) }));
  const shuffled = shuffleArr(arr);
  state.questions = shuffled;
  state.filter = 'all';
  renderQuestions();
}

/* Show Favorites modal/list (simple behavior: filter to favorites) */
function showFavoritesList(){
  // if no favorites, inform
  if(state.favorites.size === 0){
    alert('Nemáš označené žiadne obľúbené otázky.');
    return;
  }
  state.filter = 'favorites';
  // prepare state.questions as full list so filter works
  state.questions = questions.map((q,i)=>({ originalIndex:i, qtext:q.text, answers: q.answers.map((txt, idx)=>({txt, idx})) }));
  renderQuestions();
}

/* Show only wrong (button at bottom) identical to showOnlyWrong function but filters current display */
function showOnlyWrongButton(){
  showOnlyWrong();
}

/* Attach event listeners */
document.getElementById('btnShowAll').addEventListener('click', showAllCorrect);
document.getElementById('btnShuffle').addEventListener('click', ()=>{ shuffleQuestions(); });
document.getElementById('btnFavorites').addEventListener('click', showFavoritesList);
document.getElementById('btnShowAllQ').addEventListener('click', showAllQuestions);
document.getElementById('btnShowWrongOnly').addEventListener('click', ()=>{ state.filter = 'wrong'; renderQuestions(); });
document.getElementById('btnShowFavOnly').addEventListener('click', showFavoritesOnly);
document.getElementById('btnEvaluate').addEventListener('click', evaluateAll);
document.getElementById('btnShowWrong').addEventListener('click', showOnlyWrongButton);
document.getElementById('btnRetryWrong').addEventListener('click', retryWrong);
document.getElementById('btnReset').addEventListener('click', resetTest);

/* Initialize on load */
initQuestions();
</script>
</body>
</html>
